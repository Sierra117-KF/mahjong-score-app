# プロジェクトガイドライン

ユーザーへの回答は全て**日本語**で行うこと。

## 1. プロジェクト概要

### 1.1 目的

モバイルファーストで動作する、シンプルで使いやすい麻雀点数計算アプリケーションの開発

### 1.2 ターゲットユーザー

- 麻雀プレイヤー（初心者〜中級者）
- モバイルデバイスでの使用を想定

### 1.3 技術スタック

- **フロントエンド**: Next.js 16+ (App Router)
- **UI ライブラリ**: React 19.2+
- **スタイリング**: Tailwind CSS
- **バンドラー**: Turbopack (Next.js 16 のデフォルト)
- **デプロイ**: Vercel
- **言語**: TypeScript 5.1+
- **Node.js**: 20.9 以上

**Next.js 16 の主要機能（このプロジェクトで活用）：**

- **Turbopack**: デフォルトバンドラーとして高速ビルド（設定不要）
- **静的エクスポート**: サーバーレス環境での完全静的サイト生成
- **Client Components**: `'use client'`ディレクティブでクライアントサイドのみで動作

**注意点：**

- Server Components は使用せず、Client Components（`'use client'`）のみ使用
- 静的エクスポートにより、サーバーサイド機能（API Routes 等）は使用不可
- Cache Components 等の新機能は静的エクスポートでは使用しない

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 点数計算機能

- 飜数、符数、ゲーム状況から正確な点数を計算
- 計算結果をリアルタイムで表示
- 3 人打ち・4 人打ちの両方に対応

#### 2.1.2 入力設定項目

**ゲームモード**

- 4 人麻雀（四麻）/ 3 人麻雀（三麻）
- デフォルト: 4 人麻雀

**プレイヤー種別**

- 親（オヤ） / 子（コ）
- デフォルト: 子

**和了種別**

- ロン（他家の捨牌で和了）
- ツモ（自摸和了）
- デフォルト: ロン

**飜数（ハン）**

- 入力範囲: 1〜13 飜
- クイックボタン: 1, 2, 3, 4, 5 飜
- 6 飜以上はドロップダウン
- デフォルト: 1 飜

**符数（フ）**

- 主要な選択肢: 20, 25, 30, 40, 50, 60, 70, 80, 90, 100, 110 符
- ドロップダウン
- デフォルト: 30 符

**本場数（ホンバ）**

- 入力範囲: 0〜20 本場
- ドロップダウン
- デフォルト: 0 本場

#### 2.1.3 表示内容

**メイン表示**

- 飜数と符数の組み合わせ表示（例: "1 飜 30 符"）
- 計算結果の点数（大きく表示）

**詳細表示**

- 基本点
- 放銃者支払い（ロンの場合）
- 各プレイヤーの支払い（ツモの場合）
  - 4 人打ち: 親払い / 子払い
  - 3 人打ち: 各プレイヤー払い

**役満対応**

- 13 飜以上で役満として計算
- 倍役満、三倍役満にも対応

#### 2.1.4 リセット機能

- すべての設定を初期値に戻す
- ワンタップで実行可能

---

## 3. 非機能要件

### 3.1 パフォーマンス

- 初回ロード時間: 2 秒以内（3G 回線）
- バンドルサイズ: 100KB 以下（gzip 圧縮後）
- 計算処理: 即座にレスポンス（50ms 以内）

### 3.2 最適化戦略

- Turbopack による高速ビルド（Next.js 16 のデフォルト）
- コード分割は最小限（シングルページアプリ）
- Tree shaking で未使用コードを除去
- 画像を使用せず、CSS/SVG のみで UI 構築
- 外部ライブラリは最小限に抑える

### 3.3 対応環境

- **モバイル**: iOS Safari 15+, Chrome for Android 100+
- **デスクトップ**: Chrome, Firefox, Safari, Edge（最新版）
- **画面サイズ**: 320px〜1920px（レスポンシブ対応）

### 3.4 アクセシビリティ

- WCAG 2.1 AA 準拠
- タッチターゲットサイズ: 最小 44×44px
- 十分なコントラスト比（4.5:1 以上）
- キーボード操作対応

### 3.5 データ永続化

**重要：計算結果は一切保存しません**

- **データベース**: 使用しない
- **LocalStorage**: 使用しない
- **SessionStorage**: 使用しない
- **Cookie**: 使用しない
- **サーバーサイド保存**: 使用しない

**理由：**

1. **プライバシー保護**: ユーザーのゲーム内容を記録しない
2. **シンプル性**: 状態管理が不要で、バグが減る
3. **パフォーマンス**: I/O 処理がなく、高速動作
4. **メンテナンス**: データ移行やバックアップが不要

**動作仕様：**

- すべての計算は、その場限りで完結
- ページをリロードすると初期状態に戻る
- ユーザーが意図的にリセットボタンを押すまで、現在のセッションの設定値は保持（React の状態管理のみ）

### 3.6 セキュリティ

- 認証不要（パブリックアクセス）
- CSP（Content Security Policy）設定
- HTTPS 必須

---

## 4. UI/UX デザイン要件

### 4.1 デザインコンセプト

- **シンプル & クリーン**: 不要な装飾を排除
- **モダン**: フラットデザイン、適度な影と角丸
- **ダークテーマ**: 夜間使用を考慮したダークカラー
- **直感的**: 説明不要で操作できる UI

### 4.2 カラーパレット

```
背景色:
  - Primary: #1a1d2e (ダークブルーグレー)
  - Secondary: #252a3d (カード背景)

アクセントカラー:
  - Primary: #00d9c0 (ターコイズグリーン) - 選択中
  - Secondary: #3d4458 (グレー) - 非選択

テキスト:
  - Primary: #ffffff
  - Secondary: #a0aec0
```

### 4.3 タイポグラフィ

- **メイン点数**: 64px, Bold
- **見出し**: 24-32px, Semi-bold
- **ボディ**: 16-18px, Regular
- **キャプション**: 14px, Regular
- フォント: システムフォント（-apple-system, BlinkMacSystemFont, "Segoe UI"）

### 4.4 インタラクション

- ボタンホバー/タップ時: 透明度変化 + スケールアニメーション
- 点数変更時: フェードイン/スライドアニメーション
- トグルボタン: スムーズな色変化（200ms）

### 4.5 モバイル最適化

- タッチフレンドリーなボタンサイズ
- スワイプ操作は不要（タップのみ）
- 縦画面レイアウトに最適化
- ビューポート固定（スクロール不要）

---

## 5. 技術仕様

### 5.1 点数計算ロジック

#### 基本点計算式

```
基本点 = 符 × 2^(飜+2)
```

**注意**: 満貫以上（5飜以上、または4飜40符以上、または3飜70符以上）の場合は、基本点の代わりに固定の基本点を使用します。

#### 切り上げルール

```
roundUp100(value) = 100点単位で切り上げ
  例: roundUp100(1,234) = 1,300
      roundUp100(1,900) = 1,900
```

- **切り上げのタイミング**: 基本点に倍率を掛けた後、100点単位で切り上げ
- **満貫以上**: 基本点が固定値になるため、切り上げ後も固定点数

#### ロン和了の点数計算

```
親ロン: roundUp100(基本点 × 6) + 本場 × 300
子ロン: roundUp100(基本点 × 4) + 本場 × 300
```

**例**:
- 1飜30符（基本点480）子ロン: roundUp100(480 × 4) + 0 = 2,000点
- 3飜60符（基本点1,920）子ロン: roundUp100(1,920 × 4) + 0 = 7,700点

#### ツモ和了の点数計算

**【4人打ち】**

```
親ツモ:
  - 各子の支払い: roundUp100(基本点 × 2) + 本場 × 100
  - 合計獲得点: roundUp100(基本点 × 6) + 本場 × 300

子ツモ:
  - 親の支払い: roundUp100(基本点 × 2) + 本場 × 100
  - 各子の支払い: roundUp100(基本点 × 1) + 本場 × 100
  - 合計獲得点: roundUp100(基本点 × 4) + 本場 × 300
```

**【3人打ち】**

```
親ツモ:
  - 各子の支払い: roundUp100(基本点 × 2) + 本場 × 100
  - 合計獲得点: [各子の支払い] × 2人

子ツモ:
  - 親の支払い: roundUp100(基本点 × 2.5) + 本場 × 100
  - 子の支払い: roundUp100(基本点 × 1.5) + 本場 × 100
  - 合計獲得点: [親の支払い] + [子の支払い]
```

**例**:
- 2飜30符（基本点960）親ツモ 4人打ち: 各子 roundUp100(960 × 2) = 2,000点 → 合計6,000点（2,000オール）
- 1飜30符（基本点480）子ツモ 3人打ち: 親 roundUp100(480 × 2.5) = 1,300点、子 roundUp100(480 × 1.5) = 800点 → 合計2,100点

#### 満貫・跳満・倍満・三倍満・役満

```
満貫:
  - 子ロン: 8,000点
  - 親ロン: 12,000点
  - 子ツモ: 2,000/4,000点
  - 親ツモ: 4,000オール

跳満:
  - 子ロン: 12,000点
  - 親ロン: 18,000点
  - 子ツモ: 3,000/6,000点
  - 親ツモ: 6,000オール

倍満:
  - 子ロン: 16,000点
  - 親ロン: 24,000点
  - 子ツモ: 4,000/8,000点
  - 親ツモ: 8,000オール

三倍満:
  - 子ロン: 24,000点
  - 親ロン: 36,000点
  - 子ツモ: 6,000/12,000点
  - 親ツモ: 12,000オール

役満:
  - 子ロン: 32,000点
  - 親ロン: 48,000点
  - 子ツモ: 8,000/16,000点
  - 親ツモ: 16,000オール
```

### 5.2 状態管理

- React useState を使用（小規模アプリのため）
- 不要なグローバル状態管理ライブラリは導入しない

### 5.3 コンポーネント構成

```
App (page.tsx)
├── Header (タイトル表示)
├── ScoreDisplay (点数表示エリア)
├── GameModeSelector (4人/3人切り替え)
├── PlayerSelector (親/子切り替え)
├── WinTypeSelector (ロン/ツモ切り替え)
├── HanInput (飜数入力)
├── FuInput (符数入力)
├── HonbaInput (本場入力)
├── ResetButton（リセットボタン）
└── useMahjongGame hook（状態管理とスコア計算を集約）
```

### 5.4 ディレクトリ構造

```
mahjong-score-app/
├── .claude/                   # Claude Code設定
│   ├── settings.json          # 設定ファイル
│   └── commands/              # カスタムスラッシュコマンド
├── .next/                     # Next.jsビルド出力（Git除外）
├── .vscode/                   # VSCode設定
│   └── settings.json          # VSCode設定ファイル
├── node_modules/              # 依存パッケージ（Git除外）
├── src/
│   ├── app/
│   │   ├── favicon.ico        # ファビコン
│   │   ├── globals.css        # グローバルスタイル（Tailwind設定）
│   │   ├── layout.tsx         # ルートレイアウト
│   │   └── page.tsx           # メインページ（トップページ）
│   ├── components/            # UIコンポーネント
│   │   ├── NumberInput.tsx    # 数値入力コンポーネント
│   │   ├── ScoreDisplay.tsx   # 点数表示コンポーネント
│   │   └── ToggleButton.tsx   # トグルボタンコンポーネント
│   ├── hooks/                 # アプリ固有のカスタムフック
│   │   └── useMahjongGame.ts  # 入力状態と計算ロジックを集約
│   ├── lib/                   # 共有定数
│   │   └── constants.ts       # 各種セレクタとデフォルト値
│   ├── types/                 # TypeScript型定義
│   │   └── index.ts           # 型定義ファイル
│   └── utils/                 # ユーティリティ関数
│       └── scoreCalculator.ts # 点数計算ロジック
├── tests/
│   ├── unit/                  # 単体テスト
│   ├── sample.test.ts         # サンプルテスト
│   ├── setup.ts               # テストセットアップ
│   ├── tsconfig.json          # テスト用TypeScript設定
│   └── tsconfig.tsbuildinfo   # TypeScriptビルド情報（Git除外）
├── .gitignore                 # Git除外設定
├── AGENTS.md                  # AIコーディングガイドライン
├── CLAUDE.md                  # Claude Codeガイドライン
├── eslint.config.js           # ESLint設定
├── GEMINI.md                  # Googleガイドライン
├── LICENSE                    # ライセンス（MIT）
├── next-env.d.ts              # Next.js型定義（Git除外）
├── next.config.ts             # Next.js設定
├── package-lock.json          # 依存関係ロックファイル
├── package.json               # プロジェクト設定・依存関係
├── postcss.config.mjs         # PostCSS設定
├── README.md                  # プロジェクト説明
├── tsconfig.json              # TypeScript設定
├── tsconfig.test.json         # テスト用TypeScript設定
├── tsconfig.tsbuildinfo       # TypeScriptビルド情報（Git除外）
└── vitest.config.ts           # Vitestテスト設定

注意: すべてのコンポーネントは'use client'ディレクティブを使用
```

---

## 6. デプロイ要件

### 6.1 Vercel 設定

- Next.js 静的エクスポート（`output: 'export'`）
- 環境変数: 不要
- ドメイン: Vercel デフォルトドメイン or カスタムドメイン

### 6.2 ビルド最適化

```typescript
// next.config.ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: "export", // 静的エクスポート
  images: {
    unoptimized: true, // 画像最適化を無効化（使用しないため）
  },
  reactStrictMode: true,
};

export default nextConfig;
```

**ビルドコマンド：**

```bash
# Next.js 16ではTurbopackがデフォルト
npm run build

# 出力先: /out ディレクトリに静的ファイル生成
```

**Turbopack について：**

- Next.js 16 では Turbopack がデフォルトバンドラー
- 開発時: Fast Refresh が最大 10 倍高速
- 本番ビルド: 2〜5 倍高速化
- 設定不要（自動的に使用される）

### 6.3 キャッシュ戦略

- 静的ファイル: 1 年間キャッシュ
- HTML: キャッシュなし（常に最新）

---

## 7. テスト要件

### 7.1 単体テスト

- 点数計算ロジックのテスト（各パターン網羅）
- エッジケースのテスト

### 7.2 手動テスト

- 各種デバイスでの動作確認
- 計算精度の検証

### 7.3 テストケース例

```
【基本的な計算】
1. 1飜30符 子ロン（4人打ち）= 1,000点
2. 2飜30符 親ツモ（4人打ち）= 2,000オール（合計6,000点）
3. 3飜60符 子ロン（4人打ち）= 7,700点
4. 5飜以上 = 満貫（子ロン8,000点、親ロン12,000点）

【本場数の影響】
5. 1飜30符 子ロン 本場1 = 1,000 + 300 = 1,300点
6. 2飜30符 親ツモ 本場1（4人打ち）= 2,100オール（各子2,000+100）

【3人打ち】
7. 1飜30符 子ツモ（3人打ち）= 親1,300点 + 子800点 = 合計2,100点
8. 2飜30符 親ツモ（3人打ち）= 2,000オール（合計4,000点）

【満貫以上】
9. 3飜70符 = 満貫扱い（子ロン8,000点）
10. 4飜40符 = 満貫扱い（子ロン8,000点）
```

---

## 8. コード編集後の検証手順

### 8.1 必須検証コマンド

**アプリケーションコード編集後：**

```bash
npm run type-check  # TypeScript型チェック
npm run lint        # ESLintによるコード品質チェック
npm run test        # Vitestによる単体テスト実行
```

**テスト環境修正後：**

```bash
npm run type-check:test  # テストコード用TypeScript型チェック
```

### 8.2 検証フロー

1. コード編集
2. 該当する検証コマンドを実行
3. すべてのチェックが通過することを確認
4. エラーがある場合は修正して再実行

---

## 9. コマンド実行ルール

### 9.1 シェル環境

**重要：すべてのコマンドはWindows PowerShellに準拠すること**

- このプロジェクトはWindows環境（PowerShell）で実行される
- コマンド実行時は、PowerShellの構文とコマンドレットを使用すること
- Unix系シェルのコマンドは使用しないこと

### 9.2 禁止コマンド

**`cd`コマンドの使用を禁止**

- ディレクトリ移動は行わないこと
- すべてのコマンドは、プロジェクトルート（ワークスペースルート）から実行すること
- 相対パスを使用して、必要なファイルやディレクトリを指定すること

**例：**

```powershell
# ❌ 禁止: cdコマンドを使用
cd src
npm run build

# ✅ 推奨: 相対パスを使用
npm run build
```