# プロジェクトガイドライン

## 1. プロジェクト概要

### 1.1 目的
モバイルファーストで動作する、シンプルで使いやすい麻雀点数計算アプリケーションの開発

### 1.2 ターゲットユーザー
- 麻雀プレイヤー（初心者〜中級者）
- モバイルデバイスでの使用を想定

### 1.3 技術スタック
- **フロントエンド**: Next.js 16+ (App Router)
- **UIライブラリ**: React 19.2+
- **スタイリング**: Tailwind CSS
- **バンドラー**: Turbopack (Next.js 16のデフォルト)
- **デプロイ**: Vercel
- **言語**: TypeScript 5.1+
- **Node.js**: 20.9以上

**Next.js 16の主要機能（このプロジェクトで活用）：**
- **Turbopack**: デフォルトバンドラーとして高速ビルド（設定不要）
- **静的エクスポート**: サーバーレス環境での完全静的サイト生成
- **Client Components**: `'use client'`ディレクティブでクライアントサイドのみで動作

**注意点：**
- Server Componentsは使用せず、Client Components（`'use client'`）のみ使用
- 静的エクスポートにより、サーバーサイド機能（API Routes等）は使用不可
- Cache Components等の新機能は静的エクスポートでは使用しない

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 点数計算機能
- 飜数、符数、ゲーム状況から正確な点数を計算
- 計算結果をリアルタイムで表示
- 3人打ち・4人打ちの両方に対応

#### 2.1.2 入力設定項目

**ゲームモード**
- 4人麻雀（四麻）/ 3人麻雀（三麻）
- デフォルト: 4人麻雀

**プレイヤー種別**
- 親（オヤ） / 子（コ）
- デフォルト: 子

**和了種別**
- ロン（他家の捨牌で和了）
- ツモ（自摸和了）
- デフォルト: ロン

**飜数（ハン）**
- 入力範囲: 1〜13飜
- クイックボタン: 1, 2, 3, 4, 5飜
- 6飜以上はテキスト入力 or ドロップダウン
- デフォルト: 1飜

**符数（フ）**
- 主要な選択肢: 20, 25, 30, 40, 50, 60, 70, 80, 90, 100, 110符
- テキスト入力も可能（10符単位）
- デフォルト: 30符

**本場数（ホンバ）**
- 入力範囲: 0〜99本場
- テキスト入力フォーム
- デフォルト: 0本場

#### 2.1.3 表示内容

**メイン表示**
- 飜数と符数の組み合わせ表示（例: "1飜 30符"）
- 計算結果の点数（大きく表示）

**詳細表示**
- 基本点
- 放銃者支払い（ロンの場合）
- 各プレイヤーの支払い（ツモの場合）
  - 4人打ち: 親払い / 子払い
  - 3人打ち: 各プレイヤー払い

**役満対応**
- 13飜以上で役満として計算
- 倍役満、三倍役満にも対応

#### 2.1.4 リセット機能
- すべての設定を初期値に戻す
- ワンタップで実行可能

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 初回ロード時間: 2秒以内（3G回線）
- バンドルサイズ: 100KB以下（gzip圧縮後）
- 計算処理: 即座にレスポンス（50ms以内）

### 3.2 最適化戦略
- Turbopackによる高速ビルド（Next.js 16のデフォルト）
- コード分割は最小限（シングルページアプリ）
- Tree shaking で未使用コードを除去
- 画像を使用せず、CSS/SVGのみでUI構築
- 外部ライブラリは最小限に抑える

### 3.3 対応環境
- **モバイル**: iOS Safari 15+, Chrome for Android 100+
- **デスクトップ**: Chrome, Firefox, Safari, Edge（最新版）
- **画面サイズ**: 320px〜1920px（レスポンシブ対応）

### 3.4 アクセシビリティ
- WCAG 2.1 AA準拠
- タッチターゲットサイズ: 最小44×44px
- 十分なコントラスト比（4.5:1以上）
- キーボード操作対応

### 3.5 データ永続化

**重要：計算結果は一切保存しません**

- **データベース**: 使用しない
- **LocalStorage**: 使用しない
- **SessionStorage**: 使用しない
- **Cookie**: 使用しない
- **サーバーサイド保存**: 使用しない

**理由：**
1. **プライバシー保護**: ユーザーのゲーム内容を記録しない
2. **シンプル性**: 状態管理が不要で、バグが減る
3. **パフォーマンス**: I/O処理がなく、高速動作
4. **メンテナンス**: データ移行やバックアップが不要

**動作仕様：**
- すべての計算は、その場限りで完結
- ページをリロードすると初期状態に戻る
- ユーザーが意図的にリセットボタンを押すまで、現在のセッションの設定値は保持（Reactの状態管理のみ）

### 3.6 セキュリティ
- 認証不要（パブリックアクセス）
- CSP（Content Security Policy）設定
- HTTPS必須

---

## 4. UI/UXデザイン要件

### 4.1 デザインコンセプト
- **シンプル & クリーン**: 不要な装飾を排除
- **モダン**: フラットデザイン、適度な影と角丸
- **ダークテーマ**: 夜間使用を考慮したダークカラー
- **直感的**: 説明不要で操作できるUI

### 4.2 カラーパレット
```
背景色:
  - Primary: #1a1d2e (ダークブルーグレー)
  - Secondary: #252a3d (カード背景)
  
アクセントカラー:
  - Primary: #00d9c0 (ターコイズグリーン) - 選択中
  - Secondary: #3d4458 (グレー) - 非選択
  
テキスト:
  - Primary: #ffffff
  - Secondary: #a0aec0
```

### 4.3 タイポグラフィ
- **メイン点数**: 64px, Bold
- **見出し**: 24-32px, Semi-bold
- **ボディ**: 16-18px, Regular
- **キャプション**: 14px, Regular
- フォント: システムフォント（-apple-system, BlinkMacSystemFont, "Segoe UI"）

### 4.4 レイアウト構成

```
┌─────────────────────────────────┐
│  麻雀 点数計算                    │
│  Mahjong Score Calculator        │
├─────────────────────────────────┤
│                                 │
│      1飜 30符                    │
│      1,000 点                    │
│                                 │
│  基本点: 1000点                  │
│  放銃者支払い: 1,000点            │
│                                 │
├─────────────────────────────────┤
│  ゲームモード                     │
│  [4人麻雀] [3人麻雀]              │
├─────────────────────────────────┤
│  プレイヤー      和了種別          │
│  [子] [親]      [ロン] [ツモ]     │
├─────────────────────────────────┤
│  飜（ハン）                       │
│  [入力欄: 1]                     │
│  [1] [2] [3] [4] [5]             │
├─────────────────────────────────┤
│  符（フ）          本場(300点/本)  │
│  [30]             [0]            │
├─────────────────────────────────┤
│  [🔄 リセット]                    │
└─────────────────────────────────┘
```

### 4.5 インタラクション
- ボタンホバー/タップ時: 透明度変化 + スケールアニメーション
- 点数変更時: フェードイン/スライドアニメーション
- トグルボタン: スムーズな色変化（200ms）

### 4.6 モバイル最適化
- タッチフレンドリーなボタンサイズ
- スワイプ操作は不要（タップのみ）
- 縦画面レイアウトに最適化
- ビューポート固定（スクロール不要）

---

## 5. 技術仕様

### 5.1 点数計算ロジック

#### 基本点計算式
```
基本点 = 符 × 2^(飜+2)
```

#### 親の点数（ロン）
```
3人打ち: 基本点 × 6 + 本場 × 300
4人打ち: 基本点 × 6 + 本場 × 300
```

#### 子の点数（ロン）
```
3人打ち: 基本点 × 4 + 本場 × 300
4人打ち: 基本点 × 4 + 本場 × 300
```

#### 親の点数（ツモ）
```
3人打ち: 基本点 × 2 × 2人 + 本場 × 300
4人打ち: 基本点 × 2 × 3人 + 本場 × 300
```

#### 子の点数（ツモ）
```
4人打ち:
  - 親: 基本点 × 2 + 本場 × 100
  - 子: 基本点 × 1 + 本場 × 100
  
3人打ち:
  - 親: 基本点 × 2 + 本場 × 100
  - 子: 基本点 × 1 + 本場 × 100
```

#### 切り上げルール
- 100点未満を切り上げ
- 満貫以上は固定点数

#### 満貫・跳満・倍満・三倍満・役満
```
満貫:
  - 子ロン: 8,000点
  - 親ロン: 12,000点
  - 子ツモ: 2,000/4,000点
  - 親ツモ: 4,000オール
  
跳満:
  - 子ロン: 12,000点
  - 親ロン: 18,000点
  - 子ツモ: 3,000/6,000点
  - 親ツモ: 6,000オール
  
倍満:
  - 子ロン: 16,000点
  - 親ロン: 24,000点
  - 子ツモ: 4,000/8,000点
  - 親ツモ: 8,000オール
  
三倍満:
  - 子ロン: 24,000点
  - 親ロン: 36,000点
  - 子ツモ: 6,000/12,000点
  - 親ツモ: 12,000オール
  
役満:
  - 子ロン: 32,000点
  - 親ロン: 48,000点
  - 子ツモ: 8,000/16,000点
  - 親ツモ: 16,000オール
```

### 5.2 状態管理
- React useState を使用（小規模アプリのため）
- 不要なグローバル状態管理ライブラリは導入しない

### 5.3 コンポーネント構成
```
App (page.tsx)
├── Header (タイトル表示)
├── ScoreDisplay (点数表示エリア)
├── GameModeSelector (4人/3人切り替え)
├── PlayerSelector (親/子切り替え)
├── WinTypeSelector (ロン/ツモ切り替え)
├── HanInput (飜数入力)
├── FuInput (符数入力)
├── HonbaInput (本場入力)
└── ResetButton
```

### 5.4 ディレクトリ構造

```
mahjong-score-app/
├── .next/                     # Next.jsビルド出力（Git除外）
├── node_modules/              # 依存パッケージ（Git除外）
├── src/
│   └── app/
│       ├── favicon.ico        # ファビコン
│       ├── globals.css        # グローバルスタイル（Tailwind設定）
│       ├── layout.tsx         # ルートレイアウト
│       ├── page.tsx           # メインページ（トップページ）
│       ├── components/            # UIコンポーネント
│       │   ├── ScoreDisplay.tsx   # 点数表示コンポーネント
│       │   ├── ToggleButton.tsx   # トグルボタンコンポーネント
│       │   └── NumberInput.tsx    # 数値入力コンポーネント
│       ├── utils/                     # ユーティリティ関数
│       │   └── scoreCalculator.ts     # 点数計算ロジック
│       └── types/                     # TypeScript型定義
│           └── index.ts               # 型定義ファイル
├── tests/
│   ├── sample.test.ts         # サンプルテスト
│   ├── setup.ts               # テストセットアップ
│   ├── tsconfig.json          # テスト用TypeScript設定
│   └── tsconfig.tsbuildinfo   # TypeScriptビルド情報（Git除外）
├── .gitignore                 # Git除外設定
├── AGENTS.md                  # プロジェクトガイドライン
├── eslint.config.js           # ESLint設定
├── LICENSE                    # ライセンス（MIT）
├── next-env.d.ts              # Next.js型定義（Git除外）
├── next.config.ts             # Next.js設定
├── package-lock.json          # 依存関係ロックファイル
├── package.json               # プロジェクト設定・依存関係
├── postcss.config.mjs         # PostCSS設定
├── README.md                  # プロジェクト説明
├── tsconfig.json              # TypeScript設定
├── tsconfig.test.json         # テスト用TypeScript設定
├── tsconfig.tsbuildinfo       # TypeScriptビルド情報（Git除外）
└── vitest.config.ts           # Vitestテスト設定

注意: すべてのコンポーネントは'use client'ディレクティブを使用
```

---

## 6. デプロイ要件

### 6.1 Vercel設定
- Next.js静的エクスポート（`output: 'export'`）
- 環境変数: 不要
- ドメイン: Vercelデフォルトドメイン or カスタムドメイン

### 6.2 ビルド最適化
```typescript
// next.config.ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: "export",  // 静的エクスポート
  images: {
    unoptimized: true,  // 画像最適化を無効化（使用しないため）
  },
  reactStrictMode: true,
};

export default nextConfig;
```

**ビルドコマンド：**
```bash
# Next.js 16ではTurbopackがデフォルト
npm run build

# 出力先: /out ディレクトリに静的ファイル生成
```

**Turbopackについて：**
- Next.js 16ではTurbopackがデフォルトバンドラー
- 開発時: Fast Refreshが最大10倍高速
- 本番ビルド: 2〜5倍高速化
- 設定不要（自動的に使用される）

### 6.3 キャッシュ戦略
- 静的ファイル: 1年間キャッシュ
- HTML: キャッシュなし（常に最新）

---

## 7. テスト要件

### 7.1 単体テスト
- 点数計算ロジックのテスト（各パターン網羅）
- エッジケースのテスト

### 7.2 手動テスト
- 各種デバイスでの動作確認
- 計算精度の検証

### 7.3 テストケース例
```
1. 1飜30符 子ロン = 1,000点
2. 2飜30符 親ツモ = 1,000オール
3. 3飜60符 子ロン = 7,700点
4. 5飜以上 = 満貫
5. 本場1の場合 +300点
```
